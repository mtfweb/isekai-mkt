<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.order">

  <!-- 주문 등록 -->
  <insert id="insertNewOrder" parameterType="com.bookshop01.order.vo.OrderVO">
    INSERT INTO t_shopping_order
      (order_id,
       member_id,
       goods_id,
       order_goods_qty,
       receiver_name,
       receiver_hp1,
       receiver_hp2,
       receiver_hp3,
       receiver_addr1,
       receiver_addr2,
       delivery_message,
       pay_method,
       pay_orderer_hp_num,
       pay_order_time,
       order_status,
       del_yn)
    VALUES
      (#{order_id},
       #{member_id},
       #{goods_id},
       #{order_goods_qty},
       #{receiver_name},
       #{receiver_hp1},
       #{receiver_hp2},
       #{receiver_hp3},
       #{receiver_addr1},
       #{receiver_addr2},
       #{delivery_message},
       #{pay_method},
       #{pay_orderer_hp_num},
       NOW(),
       '주문접수',
       'N')
  </insert>

  <!-- 회원 주문 내역 조회 -->
  <select id="selectMyOrderList" parameterType="string" resultType="com.bookshop01.order.vo.OrderVO">
    SELECT 
      order_id,
      member_id,
      goods_id,
      order_goods_qty,
      receiver_name,
      receiver_hp1,
      receiver_hp2,
      receiver_hp3,
      receiver_addr1,
      receiver_addr2,
      delivery_message,
      pay_method,
      pay_orderer_hp_num,
      pay_order_time,
      order_status,
      del_yn
    FROM t_shopping_order
    WHERE member_id = #{member_id}
      AND del_yn = 'N'
    ORDER BY pay_order_time DESC
  </select>

  <!-- 주문 상세 조회 -->
  <select id="selectOrderDetail" parameterType="string" resultType="com.bookshop01.order.vo.OrderVO">
    SELECT 
      order_id,
      member_id,
      goods_id,
      order_goods_qty,
      receiver_name,
      receiver_hp1,
      receiver_hp2,
      receiver_hp3,
      receiver_addr1,
      receiver_addr2,
      delivery_message,
      pay_method,
      pay_orderer_hp_num,
      pay_order_time,
      order_status,
      del_yn
    FROM t_shopping_order
    WHERE order_id = #{order_id}
      AND del_yn = 'N'
  </select>

  <!-- 주문 취소 (논리 삭제) -->
  <update id="cancelOrder" parameterType="string">
    UPDATE t_shopping_order
    SET del_yn = 'Y',
        order_status = '취소'
    WHERE order_id = #{order_id}
  </update>

</mapper>
